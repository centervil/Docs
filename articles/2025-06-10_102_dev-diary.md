## Zenn記事自動変換エンジンのための最適化

あなたはZenn記事の自動変換エンジンとして、以下の入力テキストを指定されたテンプレート形式に従って変換します。元の内容と意図は維持しつつ、文章の流れを改善し、読みやすさを向上させることを目指します。

# 入力テキスト

<!-- Generated by SpecStory -->

# 開発日記変換プロセス改善計画 (2025-06-10 09:50:56)

_**User**_

本日の開発テーマは、`@diary-convert.yml` の改修です。`Diary-Converter` の利用を廃止し、変換エンジンを `Content-Converter` に変更します。`Content-Converter` については、[README](https://github.com/centervil/Content-Converter/blob/b7d91d8ff7c116362c21e3047c33d6b38fad4bf7/README.md) を参照してください。まずは作業計画を立ててください。

---

_**Assistant**_

---

承知いたしました。本日の開発テーマは、`@diary-convert.yml` の改修、および `Diary-Converter` から `Content-Converter` への変換エンジン移行ですね。

**作業計画（要約）**

1.  `Content-Converter` の使い方を確認
2.  ワークフローの修正方針を検討
3.  テンプレートやプロンプトの扱い方を整理

---

_**User**_

GitHubリポジトリ上のファイルの内容を取得するためのURLは、どのように決まりますか？

---

_**Assistant**_

---

GitHubリポジトリ上のファイル内容を直接取得するURLの形式は、以下の通りです。

```
https://raw.githubusercontent.com/{owner}/{repo}/{branch}/{path_to_file}
```

---

_**User**_

[https://raw.githubusercontent.com/centervil/Content-Converter/main/README.md](https://raw.githubusercontent.com/centervil/Content-Converter/main/README.md)

---

_**Assistant**_

---

READMEの内容を確認しました。`Content-Converter` は pip でインストールして使用するCLIツールであると理解しました。

---

_**User**_

READMEをきちんと読んでください。`Content-Converter` は pip install で実行環境にインストールして使うものであり、GitHub Actions としては使用できません。

---

_**Assistant**_

---

ご指摘ありがとうございます。`Content-Converter` は GitHub Action としてではなく、pip でインストールして使用するCLIツールであることを再確認しました。

**修正方針**

- Python 環境のセットアップ
- `Content-Converter` のインストール
- コマンドラインでの実行への変更

---

_**User**_

修正方針はOKです。それでは、実際に `content-converter` の処理をローカルで試してみましょう。`@2025-06-09_101_development.md` を変換してください。モデルは `gemini-flash-001` を使用し、APIキーは `.env` ファイルに `GOOGLE_API_KEY` として登録しました。

---

_**Assistant**_

---

ローカルで仮想環境を作成し、`Content-Converter` をインストールします。必要な依存パッケージも追加します。

- .env ファイルのAPIキーが認識されない場合は、`--api-key` 引数で直接渡す方法も検討します。
- コマンド実行例やエラー内容は省略します。

---

_**User**_

`@2025-06-09_101_development.md` を確認したところ、いくつかの問題点があります。

1.  記事全体がコードブロックで囲まれている。
2.  "この記事は GPT-4 によって自動生成されています。" となっているが、モデル名が異なる。
3.  前回の記事スラッグが入力されていない。
4.  ファイルの文末に、余計な文章が入力されている。

これらの解決策として、`Content-Converter` に渡す `--prompt` 引数に渡すプロンプトを工夫し、こちらから入力を制御するようにしましょう。

---

_**Assistant**_

---

**解決策要約**

- プロンプトファイルを新規作成し、出力要件（コードブロック禁止、モデル名の明示、スラッグの指定、余計な文の禁止など）を明記する。
- テンプレート内の `[LLM Model 名]` `[前回の記事スラッグ]` は、パイプラインで置換する方式に変更する。

---

_**User**_

`find-prev-article` と `find-diary` の部分はスクリプト化しましょう。

---

_**Assistant**_

---

`find-latest-diary.sh` および `find-prev-article.sh` を `tools/` ディレクトリに新規作成し、ローカルとCI/CD環境で共通利用できるようにしました。

---

_**User**_

ローカルで動作確認を行いましょう。

---

_**Assistant**_

---

スクリプトと `Content-Converter` を組み合わせてローカルで動作確認を行います。テンプレート置換、プロンプト指定、変換、後処理までの一連の流れを確認します。

---

_**User**_

`@2025-06-09_101_dev-diary.md` を確認すると、まだコードブロックが残っています。この問題は以前にも発生しており、LLMによる処理の限界だと認識しています。そこで、`Content-Converter` が処理したテキストの後処理を行います。以前作成した `@document_processor.py` が利用可能か確認し、利用可能であればパイプラインに組み込んでください。

---

_**Assistant**_

---

`document_processor.py` の `remove_markdown_code_block` メソッドを活用し、`Content-Converter` の出力後に後処理を追加します。

- コードブロックが残る問題を自動的に解消できるように、パイプラインに組み込みます。

---

_**User**_

これで本日の開発はすべて完了です。

---

_**Assistant**_

---

本日の開発では、`Content-Converter` への移行、ワークフローのスクリプト化、テンプレートとプロンプトの改善、記事後処理の自動化まで、一連の流れを整理・実装しました。

---

# 使用するテンプレート

---

title: "（開発日記 No.[連番]）"
emoji: "📝"
type: "idea"
topics: ["開発日記", "プログラミング"]
published: false

---

:::message
この記事はgemini-2.5-flash-preview-04-17によって自動生成されています。
:::

## 関連リンク

- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-10_102_dev-diary)

<!-- LLM_INSTRUCTIONS_START -->

# LLM変換指示

以下の開発日記を、Zenn公開用の記事（type: idea）に変換してください。

## 基本ルール

1.  **Frontmatter**:
    *   `title`: 開発日記の内容を要約した**簡潔で具体的なタイトル**を生成し、`（開発日記 No.[連番]）` の形式で設定してください。（`#` ではなく `No.` を使用）**コロン（:）は使用しないでください。**
    *   `emoji`: 記事内容に最も適した絵文字を1つ選んでください。
    *   `type`: `idea` で固定してください。
    *   `topics`: 内容に合わせて `"開発日記"` を含む適切なトピックを3つ程度設定してください。
    *   `published`: `false` で固定してください。
2.  **メッセージボックス**: Frontmatterの直後に、必ず `:::message` と `:::` で囲んで、以下のテキストのみを含むメッセージボックスを**正確に**追加してください。

    ```
    :::message
    この記事はgemini-2.5-flash-preview-04-17によって自動生成されています。
    :::
    ```
3.  **関連リンク**: メッセージボックスの直後に、必ず `## 関連リンク` という見出しを使用し、その下に**箇条書き (`-`)** で「前回の開発日記」へのリンクのみを含むセクションを追加してください。リンクの形式は `- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-10_102_dev-diary)` としてください。（`2025-06-10_102_dev-diary` 部分は提供されたスラッグに置換されます。**記事タイトルは含めないでください。**）
4.  **文体と構成**:
    *   開発日記の「会話ログ」セクションを、対話形式ではなく、自然なストーリー形式（一人称視点）に書き直してください。
    *   技術的な内容は正確に保持しつつ、平易な言葉で読みやすく整理してください。
    *   「所感」セクションを特に充実させ、開発者の視点、思考プロセス、