---
title: "Content-Converter移行と自動化パイプライン構築 (開発日記 No.102)"
emoji: "⚙️"
type: "idea"
topics: ["開発日記", "Content-Converter", "CI/CD"]
published: false
---

:::message
この記事はgemini-2.0-flash-001によって自動生成されています。
:::

## 関連リンク

- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-17_109_dev-diary)

## はじめに

昨日はPyPIリリース作業に伴う様々な問題解決とリリースガイドの見直しを行いました。本日は、`@diary-convert.yml` の改修をテーマに、変換エンジンを Diary-Converter から Content-Converter へ移行します。

## 背景と目的

これまで利用していた Diary-Converter を廃止し、Content-Converter へ移行することで、より柔軟な変換処理を実現することが目的です。また、CI/CDパイプラインの安定化、テンプレート・プロンプト・スクリプトの整備も合わせて行い、開発効率の向上を目指します。

## 検討内容

Content-Converter の使い方を確認し、既存ワークフロー（`diary-convert.yml`）の修正方針を検討しました。特に、テンプレートとプロンプトの整理、スクリプト化（`find-latest-diary.sh`、`find-prev-article.sh`）、テンプレート置換・後処理の自動化について議論しました。LLM出力の安定性、テンプレート適用の一貫性、CI/CDとローカル環境での挙動差異が懸念点として挙げられました。

## 実装内容

1.  **Content-Converter の利用検証:** ローカル環境に仮想環境を作成し、Content-Converter をインストール。必要な依存パッケージを追加しました。
2.  **テンプレートとプロンプトの修正:** prompt ファイルを新規作成し、出力要件（コードブロック禁止、モデル名・スラッグの明示、余計な文の禁止等）を明記しました。テンプレート内の `[LLM Model 名]` `[前回の記事スラッグ]` はパイプラインで置換する方式に変更しました。
3.  **スクリプトの作成:** `find-latest-diary.sh`、`find-prev-article.sh` を `tools/` に新規作成し、ローカルと CI/CD 環境で共通利用できるようにしました。
4.  **ローカルでの動作確認:** スクリプトと Content-Converter を組み合わせてローカルで動作確認を行いました。テンプレート置換、prompt 指定、変換、後処理までの一連の流れを確認しました。
5.  **後処理の自動化:** Content-Converter の出力に残存するコードブロックを除去するため、以前作成した `@document_processor.py` の `remove_markdown_code_block` メソッドを活用し、Content-Converter の出力後に後処理を追加しました。

## 技術的なポイント

- Content-Converter をCLIツールとして運用し、テンプレート置換と後処理を自動化しました。
- LLM出力の安定化とテンプレート適用の一貫性を確保するため、prompt ファイルを詳細に記述しました。
- スクリプトを共通化することで、ローカルと CI/CD 環境での運用効率を向上させました。

## 所感

Content-Converter への移行作業は、予想以上にスムーズに進みました。特に、スクリプト化による自動化は、今後の開発効率に大きく貢献すると感じています。一方で、LLMの出力にはまだ不安定な部分があり、後処理の自動化が不可欠であることが改めて認識できました。テンプレートとプロンプトの調整は、試行錯誤の連続でしたが、徐々に改善が見られています。

## 今後の課題

LLM出力の安定性をさらに向上させるために、プロンプトの改善を継続する必要があります。また、CI/CD パイプラインでの動作確認を徹底し、ローカル環境との差異を解消する必要があります。

## まとめ

本日の開発では、Content-Converter への移行、ワークフローのスクリプト化、テンプレート・プロンプトの工夫、記事後処理の自動化まで一連の流れを整理・実装しました。これにより、開発プロセスの効率化と記事品質の向上が期待できます。