---
title: "Content-Converter への移行と自動化パイプライン構築（開発日記 No.102）"
emoji: "⚙️"
type: "idea"
topics: ["開発日記", "Content-Converter", "CI/CD"]
published: false
---

:::message
この記事はgemini-2.5-flash-preview-04-17によって自動生成されています。
:::

## 関連リンク

- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-10_102_dev-diary)

## はじめに

昨日はPyPIリリース作業におけるバージョン競合やCI/CDの問題解決、リリースガイドの見直しを行いました。本日は、`@diary-convert.yml` の改修をテーマに、Diary-Converter から Content-Converter への移行と、それに伴うワークフローの改善に取り組みます。

## 背景と目的

これまで利用していた Diary-Converter を廃止し、より柔軟で拡張性の高い Content-Converter へ移行することで、記事生成パイプラインの効率化と安定化を図ります。また、手作業で行っていたテンプレートの置換や後処理を自動化することで、開発者の負担を軽減し、より創造的な作業に集中できる環境を目指します。

## 検討内容

移行にあたり、以下の項目について検討を行いました。

*   Content-Converter の利用方法の確認
*   ワークフロー (`diary-convert.yml`) の修正方針
*   テンプレートとプロンプトの整理
*   スクリプト化 (`find-latest-diary.sh`, `find-prev-article.sh`)
*   テンプレート置換・後処理の自動化

これらの検討を通して、既存ワークフローの問題点を洗い出し、段階的に修正していく方針を決定しました。

## 実装内容

具体的な実装内容としては、以下の作業を実施しました。

1.  **Content-Converter の動作確認:** ローカル環境に仮想環境を構築し、Content-Converter をインストールして動作確認を行いました。
2.  **プロンプトファイルの作成:** LLM の出力要件（コードブロック禁止、モデル名・スラッグの明示、余計な文の禁止等）を明記したプロンプトファイルを新規作成しました。
3.  **スクリプトの作成:** `find-latest-diary.sh` と `find-prev-article.sh` を `tools/` ディレクトリに作成し、ローカルと CI/CD 環境で共通利用できるようにしました。
4.  **ローカルでの動作確認:** 作成したスクリプトと Content-Converter を組み合わせてローカルで動作確認を行い、テンプレート置換、プロンプト指定、変換、後処理までの一連の流れを確認しました。
5.  **後処理の自動化:** 以前作成した `@document_processor.py` の `remove_markdown_code_block` メソッドを活用し、Content-Converter の出力後に不要なコードブロックを削除する処理を追加しました。

## 技術的なポイント

今回の実装における技術的なポイントは以下の通りです。

*   **Content-Converter の CLI 運用:** Content-Converter を CLI ツールとして運用し、パイプラインに組み込むことで、柔軟なカスタマイズを可能にしました。
*   **テンプレート置換・後処理の自動化:** テンプレートの置換と記事の後処理を自動化することで、手作業によるミスを削減し、効率的な記事生成を実現しました。
*   **スクリプトの共通化:** ローカルと CI/CD 環境で共通のスクリプトを使用することで、環境による挙動の差異をなくし、運用効率を向上させました。

## 所感

Content-Converter への移行作業を通して、記事生成パイプラインの改善における様々な課題が見えてきました。特に、LLM の出力の安定性や、テンプレート適用の一貫性を保つことの難しさを改めて認識しました。しかし、今回の自動化によって、これまで手作業で行っていた作業から解放され、より本質的な開発に集中できるようになったと感じています。

## 今後の課題

今後の課題としては、以下の点が挙げられます。

*   LLM の出力の安定性を向上させるためのプロンプトの改善
*   テンプレート適用の一貫性を担保するための仕組みの導入
*   CI/CD パイプラインの更なる安定化

これらの課題を解決することで、より高品質な記事を効率的に生成できる体制を構築していきたいと考えています。

## まとめ

本日の開発では、Diary-Converter から Content-Converter への移行、ワークフローのスクリプト化、テンプレートとプロンプトの改善、記事後処理の自動化まで、一連の流れを整理し、実装しました。これにより、記事生成パイプラインの効率化と安定化を図ることができました。今後は、残された課題を解決し、更なる改善を目指していきます。