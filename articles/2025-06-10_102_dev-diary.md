---
title: "Content-Converter 移行と CI/CD パイプライン構築 (開発日記 No.122)"
emoji: "⚙️"
type: "idea"
topics: ["開発日記", "Content-Converter", "CI/CD"]
published: false
---

:::message
この記事はgemini-2.0-flash-001によって自動生成されています。
:::

## 関連リンク

- [前回の開発日記](https://zenn.dev/centervil/articles/2025-07-01_121_dev-diary)

## はじめに

昨日は PyPI リリースの問題解決とリリースガイドの見直しを行いました。本日は、`@diary-convert.yml` の改修を行い、変換エンジンを Diary-Converter から Content-Converter へ移行することを目指します。

## 背景と目的

従来の Diary-Converter の利用を廃止し、Content-Converter へ移行することで、より柔軟で効率的な変換パイプラインを構築することが目的です。Content-Converter の機能を最大限に活用し、開発プロセスの自動化と効率化を図ります。

## 検討内容

Content-Converter の使い方を確認し、`diary-convert.yml` の修正方針を検討しました。また、テンプレートとプロンプトの整理、スクリプト化（`find-latest-diary.sh`, `find-prev-article.sh`）、テンプレート置換・後処理の自動化について議論しました。特に、LLM 出力の安定性、テンプレート適用の一貫性、CI/CD とローカル環境での挙動差異について注意深く検討しました。

## 実装内容

1.  **Content-Converter の利用検証:** ローカル環境に Content-Converter をインストールし、CLI ツールとしての動作を確認しました。
2.  **ワークフロー修正:**  `@diary-convert.yml` を修正し、Content-Converter を利用するように変更しました。
3.  **テンプレートとプロンプトの整理:** prompt ファイルを新規作成し、出力要件（コードブロック禁止、モデル名・スラッグの明示、余計な文の禁止等）を明記しました。テンプレート内の `[LLM Model 名]` `[前回の記事スラッグ]` はパイプラインで置換する方式に変更しました。
4.  **スクリプト作成:** `find-latest-diary.sh`, `find-prev-article.sh` を `tools/` に新規作成し、ローカル・CI/CD 共通で利用できるようにしました。

    ```bash
    # find-latest-diary.sh (例)
    #!/bin/bash
    # 最新の開発日記ファイルを探す
    ```

5.  **ローカルでの動作確認:** スクリプトと Content-Converter を組み合わせてローカルで動作確認を行い、テンプレート置換、prompt 指定、変換、後処理まで一連の流れを確認しました。
6.  **後処理の自動化:** 以前作成した `@document_processor.py` の `remove_markdown_code_block` メソッドを活用し、Content-Converter の出力後に不要なコードブロックを削除する処理を追加しました。

    ```python
    # document_processor.py (例)
    import re

    def remove_markdown_code_block(text):
        """Markdown のコードブロックを削除する"""
        return re.sub(r'```.*?```', '', text, flags=re.DOTALL)
    ```

## 技術的なポイント

Content-Converter の CLI 運用、テンプレート置換、後処理の自動化を実装しました。LLM 出力の安定化とテンプレート適用の一貫性を確保するために、プロンプトを詳細に記述しました。また、スクリプトの共通化により、運用効率を向上させました。

## 所感

Content-Converter への移行は、当初予想していたよりもスムーズに進みました。特に、以前作成した `document_processor.py` を再利用できたことが大きかったです。しかし、LLM の出力には依然として不安定な部分があり、後処理の重要性を再認識しました。CI/CD 環境とローカル環境での挙動差異を吸収するためのスクリプト作成は、少し苦労しましたが、自動化の基盤を構築できたと感じています。

## 今後の課題

LLM の出力安定性をさらに向上させるために、プロンプトの改善を継続する必要があります。また、Content-Converter の機能をより深く理解し、テンプレート置換処理をさらに洗練させたいと考えています。

## まとめ

本日の開発では、Content-Converter への移行、ワークフローのスクリプト化、テンプレート・プロンプトの工夫、記事後処理の自動化まで一連の流れを整理・実装しました。これにより、開発プロセスの自動化と効率化が大きく進展しました。