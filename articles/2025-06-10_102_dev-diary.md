---
title: "Content-Converter への移行と自動化パイプライン構築（開発日記 No.102）"
emoji: "⚙️"
type: "idea"
topics: ["開発日記", "プログラミング", "CI/CD"]
published: false
---

:::message
この記事はgemini-2.5-flash-preview-04-17によって自動生成されています。
:::

## 関連リンク

- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-11_103_dev-diary)

## はじめに

昨日はPyPIリリース作業におけるバージョン競合やCI/CDの問題解決、リリースガイドの見直しを行いました。本日は、`@diary-convert.yml` の改修をテーマに、Diary-Converter の利用を廃止し、変換エンジンを Content-Converter に変更します。

## 背景と目的

これまで利用してきた Diary-Converter を Content-Converter に移行することで、変換処理の効率化と柔軟性の向上を目指します。また、CI/CDパイプラインを安定化させ、テンプレートやプロンプト、スクリプトを整備することで、開発プロセスの自動化を推進します。

## 検討内容

Content-Converter の使い方を確認し、ワークフロー（`diary-convert.yml`）の修正方針を検討しました。具体的には、テンプレートとプロンプトの整理、スクリプト化（`find-latest-diary.sh`, `find-prev-article.sh`）、テンプレート置換・後処理の自動化について議論しました。

## 実装内容

1.  **Content-Converter の利用準備:** ローカル環境に仮想環境を作成し、Content-Converter を `pip install` でインストールしました。必要な依存パッケージも追加しました。
2.  **プロンプトファイルの作成:** LLM の出力要件（コードブロック禁止、モデル名・スラッグの明示、余計な文の禁止等）を明記したプロンプトファイルを新規作成しました。テンプレート内の `[LLM Model 名][前回の記事スラッグ]` はパイプラインで置換する方式に変更しました。
3.  **スクリプトの作成:** `find-latest-diary.sh` と `find-prev-article.sh` を `tools/` に新規作成し、ローカルと CI/CD の両方で共通利用できるようにしました。
4.  **ローカルでの動作確認:** スクリプトと Content-Converter を組み合わせてローカルで動作確認を行いました。テンプレート置換、プロンプト指定、変換、後処理までの一連の流れを確認しました。
5.  **後処理の自動化:** Content-Converter の出力後に残るコードブロックを除去するため、以前作成した `@document_processor.py` の `remove_markdown_code_block` メソッドを活用し、後処理を追加しました。

## 技術的なポイント

- Content-Converter を CLI ツールとして運用し、テンプレート置換と後処理を自動化しました。
- LLM 出力の安定化とテンプレート適用の一貫性を確保するためのプロンプトを工夫しました。
- スクリプトの共通化により、ローカル環境と CI/CD 環境での運用効率を向上させました。

## 所感

Content-Converter への移行作業は、予想以上にスムーズに進みました。特に、スクリプトの共通化によって、ローカルでの動作確認が CI/CD 環境とほぼ同じ条件で行えるようになったのは大きな進歩です。しかし、LLM の出力にはまだ不安定な部分があり、後処理が完全に不要になるまでには、更なるプロンプトの改善が必要だと感じています。

## 今後の課題

- LLM の出力品質を向上させるためのプロンプト改善。
- 後処理の完全自動化。
- CI/CD パイプラインの安定性向上。

## まとめ

本日の開発では、Content-Converter への移行、ワークフローのスクリプト化、テンプレート・プロンプトの改善、記事後処理の自動化までの一連の流れを整理・実装しました。これにより、開発プロセスの効率化と自動化が大きく進展しました。