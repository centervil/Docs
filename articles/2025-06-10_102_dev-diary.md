## Zenn記事自動変換エンジンの最適化されたコンテンツ

あなたはZenn記事の自動変換エンジンです。以下の入力テキストを、指定されたテンプレート形式に従って変換します。

# 入力テキスト

<!-- Generated by SpecStory -->

# 開発日記変換処理改善計画 (2025-06-10 09:50:56)

_**User**_

本日の開発テーマは、`@diary-convert.yml` の改修です。`Diary-Converter` の利用を停止し、変換エンジンを `Content-Converter` に変更します。`Content-Converter` については、[こちら](https://github.com/centervil/Content-Converter/blob/b7d91d8ff7c116362c21e3047c33d6b38fad4bf7/README.md) を参照してください。まずは、作業計画を立てましょう。

---

_**Assistant**_

---

承知いたしました。本日の開発テーマは `diary-convert.yml` の改修、および変換エンジンの `Content-Converter` への移行ですね。

**作業計画**

1.  `Content-Converter` の利用方法を確認する。
2.  ワークフローの修正方針を検討する。
3.  テンプレートやプロンプトの扱い方を整理する。

---

_**User**_

GitHubリポジトリ上のファイルの内容を取得するためのURLは、どのように決まりますか？

---

_**Assistant**_

---

GitHubリポジトリ上のファイル内容を直接取得するURLは、以下の形式で指定します。

`https://raw.githubusercontent.com/{owner}/{repo}/{branch}/{path_to_file}`

---

_**User**_

[https://raw.githubusercontent.com/centervil/Content-Converter/main/README.md](https://raw.githubusercontent.com/centervil/Content-Converter/main/README.md)

---

_**Assistant**_

---

READMEの内容を確認しました。`Content-Converter` は `pip` でインストールして使用するCLIツールであることがわかりました。

---

_**User**_

READMEをきちんと読んでください。`Content-Converter` は `pip install` で実行環境にインストールして使うものであり、GitHub Actionsとしては使用できません。

---

_**Assistant**_

---

ご指摘ありがとうございます。`Content-Converter` は GitHub Actions ではなく、`pip` でインストールして使用するCLIツールであることを再確認しました。

**修正方針**

*   Python環境をセットアップする。
*   `Content-Converter` をインストールする。
*   コマンドラインでの実行に変更する。

---

_**User**_

修正方針はOKです。それでは、実際に `content-converter` の処理をローカル環境で試してみましょう。`@2025-06-09_101_development.md` を変換してください。モデルは `gemini-flash-001`、APIキーは `.env` ファイルに `GOOGLE_API_KEY` として登録しました。

---

_**Assistant**_

---

ローカルで仮想環境を作成し、`Content-Converter` をインストールします。必要な依存パッケージも追加します。

*   `.env` ファイルのAPIキーが認識されない場合は、`--api-key` 引数で直接渡す方法も検討します。
*   コマンド実行例やエラー内容は省略します。

---

_**User**_

`@2025-06-09_101_development.md` を確認したところ、いくつかの問題点が見つかりました。

1.  記事全体がコードブロックで囲まれている。
2.  "この記事は GPT-4 によって自動生成されています。" となっているが、モデル名が異なる。
3.  前回の記事スラッグが入力されていない。
4.  ファイルの文末に、余計な文章が入力されている。

解決策として、`Content-Converter` に渡す `--prompt` 引数に渡すプロンプトを工夫し、こちらから指示を入力するようにしましょう。

---

_**Assistant**_

---

**解決策**

*   プロンプトファイルを新規作成し、出力要件（コードブロックの禁止、モデル名・スラッグの明示、不要な文章の禁止など）を明記する。
*   テンプレート内の `[LLM Model 名]`、`[前回の記事スラッグ]` はパイプラインで置換する方式に変更する。

---

_**User**_

`find-prev-article` と `find-diary` の部分はスクリプト化しましょう。

---

_**Assistant**_

---

`find-latest-diary.sh`、`find-prev-article.sh` を `tools/` ディレクトリに新規作成し、ローカル環境とCI/CD環境の両方で利用できるようにしました。

---

_**User**_

ローカルで動作確認しましょう。

---

_**Assistant**_

---

スクリプトと `Content-Converter` を組み合わせてローカルで動作確認を行います。テンプレート置換、プロンプト指定、変換、後処理までの一連の流れを確認します。

---

_**User**_

`@2025-06-09_101_dev-diary.md` を確認したところ、まだコードブロックが残っています。この問題は以前にも発生しており、LLMによる処理の限界だと認識しています。そこで、`Content-Converter` が処理したテキストの後処理を行うことにします。以前作成した `@document_processor.py` が利用可能か確認し、利用できる場合はパイプラインに組み込んでください。

---

_**Assistant**_

---

`document_processor.py` の `remove_markdown_code_block` メソッドを活用し、`Content-Converter` の出力後に後処理を追加します。

*   コードブロックが残る問題を自動で解消できるように、パイプラインに組み込みます。

---

_**User**_

これで本日の開発は終了です。

---

_**Assistant**_

---

本日の開発では、`Content-Converter` への移行、ワークフローのスクリプト化、テンプレートとプロンプトの改善、記事の後処理自動化まで、一連の流れを整理・実装しました。

---

# 使用するテンプレート

---
title: "（開発日記 No.[連番]）" # LLMが内容に基づいてタイトルを生成
emoji: "📝"
type: "idea" # tech から idea に変更
topics: ["開発日記", "プログラミング"] # 内容に応じてLLMが調整
published: false
---

:::message
この記事はgemini-2.5-flash-preview-04-17によって自動生成されています。
:::

## 関連リンク

- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-09_101_dev-diary)

<!-- LLM_INSTRUCTIONS_START -->
# LLM変換指示

以下の開発日記を、Zenn公開用の記事（type: idea）に変換してください。

## 基本ルール

1.  **Frontmatter**:
    *   `title`: 開発日記の内容を要約した**簡潔で具体的なタイトル**を生成し、`（開発日記 No.[連番]）` の形式で設定してください。（`#` ではなく `No.` を使用）**コロン（:）は使用しないでください。**
    *   `emoji`: 記事内容に最も適した絵文字を1つ選んでください。
    *   `type`: `idea` で固定してください。
    *   `topics`: 内容に合わせて `"開発日記"` を含む適切なトピックを3つ程度設定してください。
    *   `published`: `false` で固定してください。
2.  **メッセージボックス**: Frontmatterの直後に、必ず `:::message` と `:::` で囲んで、以下のテキストのみを含むメッセージボックスを**正確に**追加してください。

    ```
    :::message
    この記事はgemini-2.5-flash-preview-04-17によって自動生成されています。
    :::
    ```
3.  **関連リンク**: メッセージボックスの直後に、必ず `## 関連リンク` という見出しを使用し、その下に**箇条書き (`-`)** で「前回の開発日記」へのリンクのみを含むセクションを追加してください。リンクの形式は `- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-09_101_dev-diary)` としてください。（`2025-06-09_101_dev-diary` 部分は提供されたスラッグに置換されます。**記事タイトルは含めないでください。**）
4.  **文体と構成**:
    *   開発日記の「会話ログ」セクションを、対話形式ではなく、自然なストーリー形式（一人称視点）に書き直してください。
    *   技術的な内容は正確に保持しつつ、平易な言葉で読みやすく整理してください。
    *   「所感」セクションを特に充実させ、開発者の視点、