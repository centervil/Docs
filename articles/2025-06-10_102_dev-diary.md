---
title: "Content-Converter移行と自動化パイプライン構築（開発日記 No.102）"
emoji: "⚙️"
type: "idea"
topics: ["開発日記", "Content-Converter", "CI/CD"]
published: false
---

:::message
この記事はgemini-2.0-flash-001によって自動生成されています。
:::

## 関連リンク

- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-17_109_dev-diary)

## はじめに

昨日はPyPIリリース作業とその周辺の問題解決に奔走しました。今日は、開発環境の改善として、日記変換処理をDiary-ConverterからContent-Converterへ移行し、関連するワークフローを整備します。

## 背景と目的

これまで利用していたDiary-Converterを廃止し、Content-Converterへ移行することで、より柔軟な変換処理を実現し、開発効率の向上を目指します。また、CI/CDパイプラインを安定化させ、よりスムーズなリリースフローを構築することが目的です。

## 検討内容

Content-Converterの使い方を確認し、既存のワークフロー（`diary-convert.yml`）の修正方針を検討しました。また、テンプレートとプロンプトの整理、スクリプト化（`find-latest-diary.sh`, `find-prev-article.sh`）、テンプレート置換・後処理の自動化についても検討しました。

## 実装内容

1.  **Content-Converter の利用検討とローカルでのテスト:** ローカル環境にContent-Converterをインストールし、動作確認を行いました。GitHubリポジトリ上のファイル取得URLの形式（`https://raw.githubusercontent.com/{owner}/{repo}/{branch}/{path_to_file}`）を確認し、READMEを参考にしながら、Content-ConverterがCLIツールとして動作することを確認しました。

2.  **プロンプトファイルの作成とテンプレートの修正:** 新規にプロンプトファイルを作成し、出力要件（コードブロック禁止、モデル名・スラッグの明示、余計な文の禁止等）を明記しました。テンプレート内の`[LLM Model 名]`や`[前回の記事スラッグ]`はパイプラインで置換する方式に変更しました。

3.  **スクリプトの作成:** 記事のスラッグを検索するスクリプト(`find-latest-diary.sh`)と前回の記事を検索するスクリプト(`find-prev-article.sh`)を`tools/`ディレクトリに作成し、ローカルとCI/CD環境で共通利用できるようにしました。

4.  **ローカルでの動作確認:** スクリプトとContent-Converterを組み合わせ、ローカル環境で動作確認を行いました。テンプレート置換、prompt指定、変換、後処理までの一連の流れを確認しました。

5.  **後処理の自動化:** Content-Converterの出力結果に不要なコードブロックが残る問題に対処するため、以前作成した`document_processor.py`の`remove_markdown_code_block`メソッドを活用し、Content-Converterの出力後に後処理を追加しました。

## 技術的なポイント

-   Content-ConverterをCLIツールとして運用し、テンプレート置換や後処理を自動化しました。
-   LLM出力の安定化とテンプレート適用の一貫性を確保するため、プロンプトを詳細に記述しました。
-   スクリプトを共通化することで、ローカル環境とCI/CD環境での運用効率を向上させました。
-   `document_processor.py`を活用して、LLMの出力結果に対する後処理を自動化しました。

## 所感

Content-Converterへの移行作業は、当初想定していたよりもスムーズに進みました。しかし、LLMの出力の安定性やテンプレート適用の一貫性を維持するためには、プロンプトの調整や後処理の自動化が不可欠であることを再認識しました。特に、以前作成した`document_processor.py`を再利用できたことは、開発効率の向上に大きく貢献しました。

## 今後の課題

-   CI/CDパイプラインでの動作検証と安定化。
-   プロンプトの更なる改善によるLLM出力の品質向上。
-   `document_processor.py`の汎用性を高め、他のプロジェクトでも利用できるようにする。

## まとめ

本日の開発では、Diary-ConverterからContent-Converterへの移行、ワークフローのスクリプト化、テンプレート・プロンプトの改善、記事後処理の自動化までの一連の流れを整理・実装しました。これにより、開発効率の向上とCI/CDパイプラインの安定化に大きく貢献できると考えています。