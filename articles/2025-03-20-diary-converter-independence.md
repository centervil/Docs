---
title: "2025-03-20 Diary Converter Independence"
emoji: "🛠️"
type: "idea"
topics: ['開発日記', 'CI/CD', 'GitHub Actions']
published: false
---

:::message
この記事はgemini-2.0-flash-001によって自動生成されています。

:::

:::message
この記事はgemini-2.0-flash-001によって自動生成されています。
私の毎日の開発サイクルについては、[LLM対話で実現する継続的な開発プロセス](https://zenn.dev/centervil/articles/2025-03-12-development-cycle-introduction)をご覧ください。
:::

# Diary Converter の独立化

## はじめに

昨日はdiary-converter.pyを独立リポジトリとして機能させるための主要な変更を実装しました。今日は、このdiary-converter.pyを別の開発プロジェクト（別リポジトリ）からでも使えるようにすることを目指します。具体的には、diary-converterフォルダ以下を別リポジトリとして独立させ、CI/CDパイプライン中にその独立させたリポジトリからdiary_converter.pyを取得して、開発日記の変換を行えるようにします。

## 背景と目的

これまでdiary_converter.pyは、特定の開発プロジェクトに組み込まれていました。しかし、複数のプロジェクトで日記変換処理を共有したいというニーズが高まり、独立したリポジトリとして切り出すことにしました。これにより、各プロジェクトはdiary-converterのバージョン管理を個別に行う必要がなくなり、CI/CDパイプラインもより柔軟に構成できるようになります。

## 検討内容

### 課題の整理

diary-converterを独立リポジトリ化するにあたり、以下の課題が挙げられました。

1. **依存関係の管理**: 独立リポジトリとして必要な依存関係を明確にし、管理する必要がある。
2. **CI/CDパイプラインとの連携**: 既存のCI/CDパイプラインからdiary-converterをどのように呼び出すかを検討する必要がある。
3. **設定の柔軟性**: テンプレートファイルのパスやAPIキーなど、環境に依存する設定を柔軟に扱えるようにする必要がある。

### 解決アプローチ

これらの課題を解決するために、以下のアプローチを検討しました。

1. **GitHub Actionsのコンポーザブルアクション**: diary-converterをGitHub Actionsのコンポーザブルアクションとして公開し、他のリポジトリから簡単に呼び出せるようにする。
2. **Dockerイメージの提供**: diary-converterをDockerイメージとして提供し、CI/CDパイプラインでコンテナとして実行できるようにする。
3. **Gitサブモジュール**: diary-converterをGitサブモジュールとして追加し、他のリポジトリで利用できるようにする。

最終的に、最も柔軟性が高く、導入が容易なGitHub Actionsのコンポーザブルアクションを採用することにしました。

## 実装内容

### 1. 独立リポジトリ用のREADME.mdの作成

独立したリポジトリで使用するための新しいREADMEファイルを作成しました。このファイルにはツールの概要、インストール方法、使用方法、CI/CDパイプラインでの利用方法など、詳細な情報を記載しています。特に、CI/CDパイプラインでの利用方法については、以下の3つのアプローチを解説しました。

*   Gitリポジトリのクローンによるアプローチ
*   GitHubリリースからのダウンロードによるアプローチ
*   GitHub Actionsのサブモジュールアクションによるアプローチ

### 2. GitHub Actionsのコンポーザブルアクションの設定

`action.yml`ファイルを作成し、GitHub Actionsのコンポーザブルアクションとして利用できるようにしました。このアクションは以下のような形式で簡単に利用できます。

```yaml
- name: Run diary-converter
  uses: [username]/diary-converter@v1
  with:
    source_file: Documents/ProjectLogs/latest.md
    destination_file: articles/output.md
    api_key: ${{ secrets.GOOGLE_API_KEY }}
```

この設定ファイルでは、入力パラメータの定義（ソースファイル、出力先、APIキーなど）や、Pythonの設定、依存関係のインストール手順などを定義しています。また、テンプレートパスやデバッグモードなどのオプションにも対応しています。

### 3. テンプレートファイルの調整

テンプレートファイルを`templates`ディレクトリに配置し、独立リポジトリとして機能するように構造を整理しました。具体的には、`templates/zenn_template.md`としてテンプレートを配置し、テンプレートの内容はそのまま維持しました。

### 4. diary_converter.pyの修正

- デフォルトテンプレートパスを相対パスに変更しました（`./templates/zenn_template.md`）。
- テンプレート読み込み処理を改善し、相対パスを正しく解決できるようにしました。
- 独立リポジトリとして機能するために不要な特定のパス調整コードを削除しました。

### 5. Docker関連ファイルの整備

独立リポジトリで使用するためのdocker-compose.ymlファイルを作成し、適切なボリュームマウントと環境変数設定を行いました。これにより、Docker環境でもdiary-converterを簡単に実行できるようになりました。

## 技術的なポイント

今回の実装で特に重要だった技術的なポイントは、GitHub Actionsのコンポーザブルアクションの設定です。コンポーザブルアクションを使用することで、diary-converterの実行に必要な環境構築や依存関係のインストールを自動化し、他のリポジトリから簡単に呼び出せるようにしました。

また、テンプレートファイルのパスを相対パスに変更することで、diary-converterがどのディレクトリから実行されても正しくテンプレートファイルを読み込めるようにしました。

## 所感

今回の開発を通じて、GitHub Actionsのコンポーザブルアクションの強力さを改めて実感しました。これまで、CI/CDパイプラインで共通の処理を再利用するには、シェルスクリプトを共有したり、Dockerイメージを作成したりする必要がありましたが、コンポーザブルアクションを使用することで、より簡単に、より柔軟に処理を再利用できるようになりました。

また、diary-converterを独立リポジトリ化することで、各プロジェクトで日記変換処理を個別に管理する必要がなくなり、開発効率が向上することが期待できます。

## 今後の課題

今後の課題としては、以下の点が挙げられます。

1.  **テストの自動化**: diary-converterの機能テストを自動化し、品質を向上させる。
2.  **ドキュメントの充実**: diary-converterの使い方や設定方法をより詳しく解説したドキュメントを作成する。
3.  **機能の拡張**: diary-converterに新しい機能を追加し、より多様な日記形式に対応できるようにする。

## まとめ

今回は、diary-converter.pyを独立リポジトリとして切り出し、GitHub Actionsのコンポーザブルアクションとして公開することで、他のプロジェクトから簡単に利用できるようにしました。これにより、各プロジェクトは日記変換処理を個別に管理する必要がなくなり、開発効率が向上することが期待できます。また、GitHub Actionsのコンポーザブルアクションの強力さを改めて実感することができました。