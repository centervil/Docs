---
title: "32 Diaryconverter Development（開発日記 #1）"
emoji: "📝"
type: "tech"
topics: ['開発日記', 'プログラミング']
published: false
---

:::message
この記事はgemini-2.5-pro-exp-03-25によって自動生成されています。
:::

## 関連リンク

- **プロジェクトリポジトリ**: [プロジェクト](https://github.com/centervil/プロジェクト)
- **前回の開発日記**: [前回の開発日記](https://zenn.dev/centervil/articles/2025-03-31-dev-diary)
- **関連Issue**: [Issue #1](https://github.com/centervil/プロジェクト/issues/1)

# Diary-Converterの機能シンプル化

## はじめに

昨日はDiary-Converterの開発を進めました。本日は、開発体験の向上とコードの保守性向上を目指し、Diary-Converterの機能シンプル化に取り組みます。具体的には、テスト環境の統一、日記生成ロジックの簡略化、開発記録の命名規則変更を進めます。

## 背景と目的

Diary-Converterの開発を進める中で、いくつかの課題が顕在化してきました。具体的には、テスト実行環境がローカルとDockerで分かれており管理が煩雑な点、日記生成ロジックが複雑化しており改修が難しい点、そして開発記録の命名規則が統一されていない点です。これらの課題は、開発効率の低下やメンテナンスコストの増大につながる可能性があります。

今回の開発テーマは、これらの課題を解決し、よりスムーズで効率的な開発プロセスを実現すること、そしてコードベースをよりシンプルで理解しやすい状態に保つことを目的としています。

## 検討内容

### 課題の整理

今回のシンプル化で取り組むべき課題は以下の3点です。

1.  **テスト環境の混在**: 現在、ユニットテストや統合テストを実行する際、ローカル環境とDocker環境の両方を使用する必要があり、手順が煩雑で分かりにくい。
2.  **日記生成ロジックの複雑性**: `diary_converter.py` 内の日記をZenn記事形式に変換するロジックが、テンプレート処理やプロンプト生成部分で複雑化しており、可読性やメンテナンス性が低い。
3.  **開発記録の命名規則の不明確さ**: 開発記録（開発日記）のファイル名に一貫したルールがなく、ファイル名から関連情報（テーマ、プロジェクト名、通し番号など）を抽出するのが難しい。

### 解決アプローチ

これらの課題を解決するために、以下のアプローチを検討し、採用しました。

1.  **テスト環境のDockerへの統一**: すべてのテスト（ユニットテスト、統合テスト）をDockerコンテナ内で実行するように統一します。これにより、開発者間の環境差異をなくし、誰でも同じ手順でテストを実行できるようにします。実行用のシェルスクリプトも整備します。
2.  **日記生成ロジックのLLMへの委譲**: 複雑な日記生成ロジックを大幅に簡略化します。Zenn記事のテンプレートファイル (`zenn_template.md`) 内に、LLMへの指示（変換ルールや出力形式など）を直接記述するセクションを設けます。Python側のコードは、テンプレートの基本的なプレースホルダー置換と、テンプレート内の指示を抽出してLLMに渡す役割に徹します。
3.  **開発記録の命名規則の明確化と活用**: 開発記録ファイルの命名規則を `yyyy-mm-dd-[通し番号]-[テーマ名]-[プロジェクト名].md` という明確な形式に定めます。この規則に基づき、`diary_converter.py` でファイル名から日付、通し番号、テーマ名、プロジェクト名を自動的に抽出し、テンプレートのプレースホルダーを埋めるようにします。関連ドキュメントも更新します。

## 実装内容

上記の解決アプローチに基づき、以下の実装を行いました。

### 変更点1: テスト環境のDockerへの統一

ローカル環境でのテスト実行を廃止し、すべてのテストをDocker環境で実行するように統一しました。

1.  Dockerコンテナ内でユニットテストを実行するための新しいシェルスクリプト `scripts/run_docker_unit_tests.sh` を作成しました。
2.  同様に、統合テストを実行するための `scripts/run_docker_integration_tests.sh` を作成しました。
3.  既存の `run_all_tests.sh` を更新し、上記2つのスクリプトを順次実行するように変更しました。これにより、`run_all_tests.sh` を実行するだけで、Docker環境下で全てのテストが実行されるようになりました。
    ```bash
    # run_all_tests.sh の更新イメージ
    #!/bin/bash
    echo "Running all tests in Docker environment..."