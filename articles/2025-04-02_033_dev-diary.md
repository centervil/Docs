---
title: 開発日記処理とZennテンプレートを改善しました！（開発日記 No.033）
emoji: 🛠️
type: idea
topics: ["開発日記", "Zenn", "自動化", "開発効率化"]
published: false
---
:::message
この記事はgemini-2.0-flash-thinking-exp-01-21によって自動生成されています。
:::

## 関連リンク

前回の開発日記：[DiaryConverter開発（開発日記 No.032）](2025-04-01-32-DiaryConverter-development.md)

## はじめに

昨日はDiaryConverterの開発を進め、Zenn公開用の記事作成がかなり楽になってきました。今日は、さらに開発日記の処理とZennテンプレートを改善して、日々の開発をもっとスムーズに、そして記事作成の自動化をさらに進化させていくことを目指します！

## 背景と目的

これまで開発日記をZenn記事に変換するプロセスを自動化してきましたが、まだ改善の余地がありました。特に、開発日記のファイル名規則とZennテンプレートの連携部分です。以前はファイル名にテーマ名やIssue番号を含めていましたが、これらがテンプレート処理で必ずしも必要ではなく、むしろ柔軟性を損なう原因になっていると感じていました。

そこで、今回の改善では、

*   開発日記のファイル名からテーマ名やIssue番号の抽出を廃止し、よりシンプルな命名規則にする
*   Zennテンプレート側も、ファイル名に依存せず、日記の内容から必要な情報を生成するように変更する
*   Zennテンプレートをより洗練させ、不要な記述を整理する

という目的を持って取り組みました。これにより、開発日記の管理とZenn記事の生成プロセスがよりシンプルになり、メンテナンス性も向上するはずです。

## 検討内容

まず、ファイル名の処理 (`diary-filename-processor.sh`) について検討しました。これまでは日付、通し番号、テーマ名をファイル名から抽出していましたが、今回の修正で、日付と通し番号のみを抽出し、テーマ名はファイル名から除外することにしました。SLUGは `${DATE_PART}_{通し番号}_dev-diary` で固定することにします。

次に、`diary_converter.py` ですが、ここではテーマ名とプロジェクト名を参照している箇所を削除しました。Issue番号も今後は使用しない方針なので、関連する処理を削除しました。通し番号はZennテンプレートの `[連番]` に渡すように修正します。

そして、Zennテンプレート (`zenn_template.md`) です。`title` の `[テーマ名]` は外部から渡すのではなく、日記の内容から自動生成するように変更します。関連リンクは前回の開発日記のみに絞り込み、`type` は `idea` で固定、開発サイクルの紹介は削除することにしました。また、LLM変換指示と記述ガイドラインが重複していたため、一箇所にまとめて整理することにしました。

これらの変更により、全体的に設定がシンプルになり、より直感的になるはずです。

## 実装内容

具体的な実装内容としては、以下のファイルを修正しました。

1.  **`Docs/tools/diary-filename-processor.sh` の修正:**

    ファイル名から日付と通し番号のみを抽出するように修正しました。テーマ名の抽出処理を削除し、SLUGの生成ロジックを修正しました。

    ```bash
    # 修正後の diary-filename-processor.sh (一部抜粋)
    DATE_PART=$(date '+%Y-%m-%d')
    SERIAL_NUMBER=$(get_serial_number) # get_serial_number は既存の関数を想定
    SLUG="${DATE_PART}_${SERIAL_NUMBER}_dev-diary"
    ```

2.  **`Diary-Converter/src/diary_converter/diary_converter.py` の修正:**

    テーマ名、プロジェクト名、Issue番号の参照箇所を削除しました。通し番号をZennテンプレートに渡す処理を修正しました。

    ```python
    # 修正後の diary_converter.py (一部抜粋)
    def convert_to_zenn_article(diary_content, serial_number):
        template = load_zenn_template()
        article = template.replace("[連番]", str(serial_number))
        # ... (その他のテンプレート置換処理)
        return article
    ```

3.  **`Diary-Converter/templates/zenn_template.md` の修正:**

    `title` から `[テーマ名]` を削除し、内容から自動生成するように指示を修正しました。関連リンクの項目を前回の開発日記のみに限定し、`type: idea` を固定、開発サイクルの紹介を削除しました。LLM変換指示と記述ガイドラインを整理・統合しました。

    ```markdown
    ---
    title:  # タイトルは日記の内容から生成されます。例：〇〇機能を実装しました！（開発日記 No.[連番]）
    emoji:  # 記事内容に最も適した絵文字を1つ選んでください。
    type: idea
    topics: ["開発日記", "Zenn", "自動化", "開発効率化"] # 内容に合わせて適切なトピックを3つ程度設定してください。
    published: false
    ---
    :::message
    この記事はgemini-2.0-flash-thinking-exp-01-21によって自動生成されています。
    :::

    ## 関連リンク

    前回の開発日記：[前回の開発日記のタイトルとURLをここに記述] # 前回の開発日記へのリンクのみを記載してください。

    ## はじめに
    # ... (記事本文)
    ```

4.  **`Diary-Converter/action.yml` の修正:**

    `diary_converter.py` の変更に合わせて、action.ymlも修正しました。特に、不要になったパラメータの削除や、パラメータの受け渡し部分を調整しました。

5.  **テストファイルの確認:**

    ユニットテスト (`test_diary_converter.py`)、結合テスト (`test_end_to_end.py`)、テスト実行スクリプト (`run_all_tests.sh`, `run_docker_unit_tests.sh`) を確認しましたが、今回の変更による修正は不要でした。これは、既存のテストケースが今回の変更の影響を受けない範囲をカバーしていたためです。

6.  **`zenn_template.md` の再修正:**

    生成された記事でタイトルの `#` が消える問題と、関連リンクの見出しが `::: RelineLink` になる問題が発生しました。これは、テンプレートの記述とLLMへの指示が曖昧だったことが原因でした。そこで、`zenn_template.md` を再度修正し、タイトル内の連番表記を `No.[連番]` に変更、関連リンクの見出しが `## 関連リンク` となるようにLLMへの指示をより明確にしました。メッセージボックスと関連リンクの指示もさらに具体的に記述しました。

## 技術的なポイント

今回の実装で特に意識したのは、**設定のシンプル化**と**柔軟性の向上**です。ファイル名からテーマ名を削除したことで、ファイル名の命名規則がシンプルになり、管理が楽になりました。また、Zennテンプレート側でタイトルを自動生成するようにしたことで、ファイル名に依存しない、より柔軟な記事生成が可能になりました。

Zennテンプレートの指示を明確化することで、LLMが意図通りに変換してくれるようになり、より高品質な記事生成に繋がるはずです。

## 所感

今回の開発を通して、開発日記の自動変換プロセスがまた一歩進化しました！特に、Zennテンプレートの改善は、記事の品質向上に直結するので、非常に重要なステップだったと感じています。

テンプレートを修正する中で、LLMへの指示の書き方一つで出力結果が大きく変わることを改めて実感しました。より具体的に、そして明確に指示を出すことの重要性を学びました。

生成された記事に問題が見つかった時は少し焦りましたが、原因を特定し、テンプレートを修正することで無事に解決できた時は、達成感がありました。地道な改善の積み重ねが、自動化の精度を高めていく上で不可欠だと感じています。

## 今後の課題

今回の改善で、開発日記処理とZennテンプレートはかなり洗練されましたが、まだ改善の余地はあります。

*   **タイトル自動生成の精度向上:**  現状ではまだ指示が抽象的なので、より具体的な指示を検討し、LLMがより適切なタイトルを生成できるようにしたいです。
*   **記事内容に合わせた絵文字の自動選択:**  現状では絵文字は手動で選んでいますが、記事の内容を解析して、適切な絵文字を自動で選択できるようにしたいです。
*   **関連リンクの自動追加:**  前回の開発日記だけでなく、関連性の高い過去の開発日記へのリンクも自動で追加できるようにしたいです。

これらの課題を解決することで、Zenn記事の自動生成プロセスをさらに進化させ、より効率的に情報発信できるようにしていきたいです。

## まとめ

今日は、開発日記処理とZennテンプレートの改善を行い、ファイル名規則のシンプル化、テンプレートの柔軟性向上、指示の明確化などを実現しました。これにより、開発日記からZenn記事への変換プロセスがよりスムーズになり、記事の品質も向上しました。

今回の改善を通して、自動化の精度を高めるためには、地道な改善と試行錯誤が不可欠であることを改めて学びました。今後も継続的に改善を重ね、より洗練された自動化システムを構築していきたいと思います。