---
title: 開発日記処理とZennテンプレートの改善（開発日記 #033）
emoji: 🔧
type: idea
topics: ["開発日記", "自動化", "Zenn"]
published: false
---

:::message
この記事はgemini-2.5-pro-exp-03-25によって自動生成されています。
:::

::: RelineLink
[前回の開発日記](2025-04-01-32-DiaryConverter-development.md)
:::

## はじめに

こんにちは！昨日は `DiaryConverter` という、開発日記をZenn記事形式に変換するツールの開発を進めました。今日はその流れを引き継ぎ、開発日記のファイル名命名規則の変更に伴う関連スクリプトの修正と、Zenn記事テンプレート自体の改善に取り組みます。

## 背景と目的

開発を進める中で、開発日記のファイル名命名規則を見直すことにしました。具体的には、ファイル名に含めていた「テーマ名」を削除し、「日付」と「通し番号」のみを構造的に利用する形式に変更します。

この変更に伴い、以下の課題が発生しました。

1.  **ファイル名処理スクリプトの不整合**: ファイル名から情報を抽出するシェルスクリプト (`diary-filename-processor.sh`) が、古い命名規則を前提としている。
2.  **日記変換スクリプトの冗長性**: Python製の変換スクリプト (`diary_converter.py`) が、ファイル名から取得しなくなったテーマ名やプロジェクト名を参照しようとしている箇所がある。
3.  **Zennテンプレートの改善点**:
    *   タイトルをファイル名から自動設定していたが、LLMが内容に応じて生成する方が適切。
    *   関連リンクが冗長。
    *   記事タイプ (`type`) を `idea` に固定したい。
    *   不要な説明（開発サイクルの紹介）が残っている。
    *   LLMへの変換指示と記述ガイドラインが分散していて分かりにくい。

これらの課題を解決し、開発日記の自動処理フローを新しい命名規則に適合させ、よりシンプルで分かりやすいZenn記事テンプレートに改善することが今回の目的です。

## 検討内容

上記の目的を達成するために、以下の点を検討・修正することにしました。

1.  **`diary-filename-processor.sh` の修正**:
    *   新しい命名規則 (`YYYY-MM-DD_通し番号_固定文字列.md`) に合わせて、日付部分 (`YYYY-MM-DD`) と通し番号のみを抽出するように変更。
    *   テーマ名は抽出しない。
    *   Zenn記事のSLUG（URLの一部）は、`${DATE_PART}_${通し番号}_dev-diary` という固定形式で生成するように変更。

2.  **`diary_converter.py` の修正**:
    *   ファイル名からテーマ名やプロジェクト名を取得・利用している箇所を全て削除。
    *   Issue番号に関する処理も不要なため削除。
    *   ファイル名から抽出した通し番号を、Zennテンプレート内の `[連番]` プレースホルダーに挿入するように変更。

3.  **`zenn_template.md` の修正**:
    *   Frontmatterの `title:` から `[テーマ名]` プレースホルダーを削除。タイトルはLLMが内容を要約して生成する前提とする。
    *   関連リンク セクションには、前回の開発日記へのリンクのみを表示するように簡略化。
    *   Frontmatterの `type:` を `idea` に固定。
    *   「開発サイクルの紹介」セクションを削除。
    *   LLM変換指示と記述ガイドラインの内容を精査し、重複をなくして一箇所に統合・整理。

4.  **`action.yml` の確認・修正**:
    *   `diary_converter.py` の引数などに変更があった場合に備え、GitHub Actionsの定義ファイル (`action.yml`) も確認し、必要であれば修正。

5.  **テストコードの確認**:
    *   `Diary-Converter/tests/` 以下のユニットテスト、結合テストが今回の変更の影響を受けないか確認。

## 実装内容

上記の検討に基づき、以下のファイル修正を行いました。

*   **`Docs/tools/diary-filename-processor.sh`**:
    *   正規表現や文字列処理部分を修正し、日付と通し番号のみを抽出するように変更。
    *   SLUG生成ロジックを固定形式に変更。
*   **`Diary-Converter/src/diary_converter/diary_converter.py`**:
    *   ファイル名からテーマ名などを取得するコード、Issue番号関連のコードを削除。
    *   `main` 関数や関連する処理で、通し番号をテンプレートに渡すように修正。
*   **`Diary-Converter/templates/zenn_template.md`**:
    *   Frontmatterの `title` からプレースホルダーを削除し、`type: idea` を設定。
    *   関連リンク セクションを修正。
    *   不要なセクションを削除し、LLM指示/ガイドライン部分を整理。
*   **`Diary-Converter/action.yml`**:
    *   `diary_converter.py` の変更（不要になった入力の削除など）に合わせて、`inputs` 定義などを修正。

また、`Diary-Converter` のテストコード (`tests/unit/test_diary_converter.py`, `tests/integration/test_end_to_end.py`) およびテスト実行スクリプト (`run_all_tests.sh`, `run_docker_unit_tests.sh`) を確認しましたが、今回の修正範囲では特に変更は不要でした。

## 技術的なポイント

*   **シェルスクリプトでの文字列操作**: `basename`, `sed`, `cut` などのコマンドを組み合わせて、ファイル名から必要な情報を正確に抽出する処理を実装しました。特に正規表現を使った抽出部分の調整が重要でした。
*   **Pythonスクリプトのリファクタリング**: 不要になった変数や処理を削除し、コードをシンプルに保つことを意識しました。引数の受け渡し方法も変更に合わせて調整しました。
*   **Zenn Frontmatter**: `type: idea` を固定で設定することで、生成される記事の種類を明確にしました。
*   **GitHub Actionsの定義**: スクリプトの変更に伴い、Actionのインターフェース（入力パラメータ）も整合性を取る必要がありました。

## 所感

開発日記の命名規則という、一見小さな変更が、関連する複数のスクリプトやテンプレート、さらにはCI/CDの定義にまで影響を及ぼすことを改めて実感しました。依存関係を把握し、一貫性を持って修正していく作業は地味ですが重要ですね。

特に、ファイル名から抽出する情報と、LLMが内容から生成する情報の役割分担を見直したことで、各スクリプトの責務が明確になり、処理がシンプルになったのは良かった点です。ファイル名には構造的な情報（日付、連番）だけを持たせ、内容に依存する情報（タイトル）はLLMに任せる、という分担は理にかなっていると感じます。

Zennテンプレートも、不要な情報を削ぎ落とし、LLMへの指示を整理することで、かなりスッキリしました。`type: idea` に固定したことで、今後生成される開発日記記事の位置づけも明確になりました。

テストコードに変更が不要だったのは少し意外でしたが、おそらくモック化がうまく機能しているか、今回の変更がテスト対象のコアロジックのインターフェースに影響を与えなかったためでしょう。いずれにせよ、テストが存在することで、安心してリファクタリングを進められるのは大きなメリットです。

## 今後の課題

*   **LLM変換指示の管理**: 現在はZennテンプレート内に記述していますが、指示が複雑化してきた場合、テンプレートから分離して管理する方が良いかもしれません。設定ファイルや別ドキュメントとして管理する方法を検討したいです。
*   **生成記事のプレビュー**: CI/CDプロセスでZenn記事が自動生成される際、実際にどのように表示されるか簡単に確認できるプレビュー機能があると便利そうです。

## まとめ

今回は、開発日記のファイル名命名規則の変更に伴い、関連するファイル名処理スクリプト、日記変換スクリプト、Zennテンプレート、そしてGitHub Actions定義ファイルを修正・改善しました。

この作業を通じて、開発日記の自動処理フローが新しいルールに適合し、よりシンプルでメンテナンスしやすい形になりました。また、Zennテンプレートの整理により、生成される記事の品質向上も期待できます。日々の開発プロセスを支える仕組みを少しずつ改善していくのは、地道ながらも大切な作業だと感じています。