---
title: "Diary-Converter 開発日記 #1: Zenn公開用日記のフォーマット最適化"
emoji: "📝"
type: "tech"
topics: ['開発日記', 'Zenn', 'フォーマット最適化']
published: false
---

:::message
この記事はgemini-2.0-flash-001によって自動生成されています。
私の毎日の開発サイクルについては、[LLM対話で実現する継続的な開発プロセス](https://zenn.dev/centervil/articles/2025-03-12-development-cycle-introduction)をご覧ください。
:::

## 関連リンク

- **プロジェクトリポジトリ**: [Diary-Converter](https://github.com/centervil/Diary-Converter)
- **前回の開発日記**: [前回のタイトル](https://zenn.dev/centervil/articles/[前回の記事スラッグ])

# Diary-ConverterのIssue #1「Zenn公開用日記のフォーマット最適化」の解決

## はじめに

昨日はDiary-ConverterのZenn公開用日記のフォーマット最適化についてIssueを発行しました。今日は、そのIssueを解決するために開発を進めていきます。

## 背景と目的

開発日記をZenn記事として公開するためのフォーマットが最適化されておらず、手作業での修正が必要でした。より効率的にZenn記事を作成するために、フォーマットを自動で最適化することを目指します。具体的には、タイトルの形式、記事タイプ、トピックのデフォルト値、関連リンクの自動生成などを改善します。

## 検討内容

### 課題の整理

現在のZenn公開用日記のフォーマットには以下の課題があります。

1.  タイトルの形式が統一されていない
2.  記事タイプが固定されていない
3.  トピックのデフォルト値が設定されていない
4.  関連リンクを手動で追加する必要がある
5.  LLMが生成したマークダウンファイルがコードブロックで囲まれている場合がある

### 解決アプローチ

これらの課題を解決するために、以下のアプローチを検討しました。

1.  テンプレートファイルを修正し、タイトルの形式、記事タイプ、トピックのデフォルト値を設定する
2.  `diary_converter.py`を修正し、関連リンクを自動生成する機能を追加する
3.  `action.yml`を修正し、新しいパラメータを追加する
4.  `document_processor.py`を作成し、マークダウンファイル全体を囲むコードブロックを削除する機能を実装する

## 実装内容

### 変更点1: テンプレートファイル（`zenn_template.md`）の修正

タイトルのスタイルを「[プロジェクト名] 開発日記 #[連番]: [テーマ名]」形式に変更しました。また、typeを「tech」に変更し、topicsのデフォルト値に「開発日記」を追加しました。関連リンクセクションを追加しました。

### 変更点2: `diary_converter.py`の修正

新しいパラメータ（プロジェクト名、連番、前回の記事スラッグ）を追加しました。frontmatterテンプレートを修正し、関連リンクセクションの自動生成機能を追加しました。プロンプトを修正し、コマンドライン引数を追加しました。

### 変更点3: `action.yml`の修正

新しい入力パラメータを追加し、実行コマンドに新しいパラメータを追加しました。パラメータの説明を詳細化し、使用例やコメントを追加して、ユーザーが使いやすくなるように改善しました。

```yaml
inputs:
  project_name:
    description: 'プロジェクト名 (例: Diary-Converter)'
    required: true
    default: 'プロジェクト'
  issue_number:
    description: 'Issue番号または記事の連番'
    required: true
    default: '1'
  prev_article:
    description: '前回の記事スラッグ (日付プレフィックスなし)'
    required: false
```

### 変更点4: `document_processor.py`の作成

LLMによって生成されたマークダウンファイルの問題（全体がコードブロック化されている）を修正するプロセスを追加しました。拡張性を考慮して、Pythonファイルに外出しして実装しました。

```python
# document_processor.py
import re
from typing import List, Callable

class DocumentProcessor:
    def __init__(self, debug: bool = False):
        self.debug = debug
        # 処理関数のリスト（順番に実行される）
        self.processors: List[Callable[[str], str]] = [
            self.remove_markdown_code_block,
            # 将来的に他の処理関数を追加可能
            # self.fix_frontmatter_format,
            # self.normalize_headings,
            # self.fix_image_paths,
            # など
        ]

    def process(self, content: str) -> str:
        """
        ドキュメントに対して登録された全ての処理を順番に適用する
        """
        processed_content = content
        for processor in self.processors:
            processed_content = processor(processed_content)
        return processed_content

    def remove_markdown_code_block(self, content: str) -> str:
        """
        マークダウンファイル全体を囲むコードブロックを削除する
        
        LLMが生成したマークダウンファイルでは、しばしば全体が```markdownと```で囲まれている
        この関数は、そのようなコードブロックを検出して削除する
        """
        # 文書全体がコードブロックで囲まれているかチェック
        if content.startswith('```') and content.endswith('```'):
            # 先頭行と末尾の```を削除
            content = content[3:-3].strip()
            if self.debug:
                print("Removed code block (```) from start and end.")
            return content
        
        # 先頭が```markdownで始まるケース
        if content.startswith('```markdown') or content.startswith('```Markdown'):
            # 先頭行と末尾の```を削除
            lines = content.splitlines()
            if len(lines) > 1:
                content = "\n".join(lines[1:-1]).strip()
                if self.debug:
                    print("Removed code block (```markdown) from start and end.")
                return content
        
        return content
```

## 技術的なポイント

`document_processor.py`では、処理関数をリスト化し、順番に適用する仕組みを採用しました。これにより、将来的に他の問題も修正する機能を追加する際に、既存のコードを修正することなく、新しい処理関数を追加するだけで済みます。また、デバッグモードをサポートすることで、処理内容を詳細に確認できるようになりました。

## 所感

今回の開発では、Zenn公開用日記のフォーマット最適化という具体的な課題に取り組みました。特に、LLMによって生成されたマークダウンファイルの問題を解決するために、`document_processor.py`を作成したことは大きな成果でした。このファイルは、今後他の問題も修正する機能を追加する可能性があるので、拡張性を考慮して設計しました。開発を通じて、自動化の重要性を改めて認識しました。

## 今後の課題

今後の課題としては以下が挙げられます。

1.  `document_processor.py`に、他の問題（例えば、frontmatterの形式の修正、見出しの正規化、画像のパスの修正など）を修正する機能を追加する
2.  `action.yml`をさらに改善し、より使いやすいものにする
3.  テストを追加し、コードの品質を向上させる

## まとめ

今回は、Diary-ConverterのIssue #1「Zenn公開用日記のフォーマット最適化」を解決するために、テンプレートファイル、`diary_converter.py`、`action.yml`を修正し、`document_processor.py`を作成しました。これらの変更により、Zenn公開用日記のフォーマットが最適化され、より一貫性のある記事が生成されるようになりました。また、関連リンクの追加により、プロジェクト間の関連性が明確になり、読者がプロジェクトの全体像を把握しやすくなりました。
