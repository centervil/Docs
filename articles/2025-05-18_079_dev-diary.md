---
title: 🤖 複数AIエージェント間rulesファイル共有の実践（開発日記 No.079）
emoji: 🤖
type: idea
topics: ["開発日記", "AIエージェント", "ルール共有"]
published: false
---
:::message
この記事はgemini-2.0-flash-001によって自動生成されています。
:::

## 関連リンク
- [前回の開発日記](https://zenn.dev/centervil/articles/2025-05-17_078_dev-diary)

## はじめに

昨日は、複数のAIエージェント（Cursor, Windsurf, Cline）間でrulesファイルを共有する方法について検討しました。今日は、その設計に基づき、実際に共有機能を実装していきます。目指すは、各エージェントが持つ特性を活かしつつ、効率的に知識を共有できる環境の構築です！

## 背景と目的

複数のAIエージェントを連携させる際、各エージェントが同じルールや知識を共有できることは非常に重要です。しかし、各エージェントは異なるファイル形式や構造を要求するため、単純なファイル共有だけではうまくいきません。そこで、昨日は「モード選択型単一アダプター」という設計を考案しました。今日はこの設計を実装し、実際に各エージェントが共有ルールを利用できるか検証します。

## 検討内容

昨日の設計では、各AIエージェントに対してアダプターを用意し、共通のルールファイルをそれぞれの形式に変換して提供します。今回は、以下の3つのアダプターを作成します。

1.  Cursor用アダプター（.mdc形式）：フロントマターに対応
2.  Windsurf用アダプター（.md形式）：マークダウン形式
3.  Cline用アダプター（.yaml形式）：構造化データ形式

また、タスク内容に応じて適切なモードを自動選択する機能も実装します。これにより、ユーザーが明示的にモードを指定しなくても、AIエージェントが状況に応じて最適なモードを選択できるようになります。

## 実装内容

まずは、各AIエージェント用のアダプターテンプレートを作成しました。

```
1. Cursor用アダプター（.mdc形式）
2. Windsurf用アダプター（.md形式）
3. Cline用アダプター（.yaml形式）
```

次に、シンボリックリンクを作成するスクリプトを作成し、実行しました。このスクリプトは、各AIエージェントの設定ディレクトリにアダプターファイルを配置し、一元管理されたルールファイルを参照する構造を実現します。

```python
# シンボリックリンク作成スクリプト (例)
import os

agents = ["cursor", "windsurf", "cline"]
for agent in agents:
    rules_dir = f".{agent}/rules"
    adapter_file = f"{agent}_rules_adapter.{'mdc' if agent == 'cursor' else 'md' if agent == 'windsurf' else 'yaml'}"
    os.makedirs(rules_dir, exist_ok=True)
    os.symlink(f"../shared_rules/{adapter_file}", os.path.join(rules_dir, adapter_file))
```

スクリプト実行後、各ディレクトリの状態を確認しました。

```
1. `.cursor/rules` - `cursor_rules_adapter.mdc` が作成されました
2. `.windsurf/rules` - `windsurf_rules_adapter.md` が作成されました
3. `.cline/rules` - `cline_rules_adapter.yaml` が作成されました
```

シンボリックリンクが正常に作成され、各AIエージェント用のディレクトリ構造が期待通りになっていることを確認できました。

## 技術的なポイント

今回の実装における技術的なポイントは、以下の3点です。

1.  **ベースモードの概念**: `mode_development_execution`を中心としたモード管理を行い、サブタスク完了後は自動的にベースモードに戻るように設計しました。これにより、タスクの切り替えがスムーズに行えます。
2.  **AIエージェント別の最適化**: 各AIエージェントが求める形式（拡張子やフォーマット）に合わせてアダプターを作成しました。Cursorにはフロントマター対応の詳細なガイドライン、Windsurfにはマークダウン形式の詳細なガイドライン、Clineには構造化データによる明確なルールとパターン定義を提供します。
3.  **自動モード検出**: タスク内容に基づいて適切なモードを自動選択する機能を実装しました。ユーザー指示のパターンマッチングによるモード切り替えも可能です。

## 所感

今日は、昨日考えた設計を実際に形にすることができて、達成感を感じています！特に、各AIエージェントの特性に合わせてアダプターを作成する部分では、それぞれの違いを理解する必要があり、少し苦労しました。しかし、その分、各エージェントが最大限に能力を発揮できるような環境を構築できたのではないかと思います。

また、自動モード選択機能の実装は、ユーザーエクスペリエンスの向上に大きく貢献すると感じています。ユーザーが明示的にモードを指定しなくても、AIエージェントが状況に応じて最適なモードを選択してくれるので、より自然な対話が可能になります。

## 今後の課題

今後の課題としては、以下の点が挙げられます。

1.  **機能拡張**: 新しいモードや知識を追加する際のワークフローを確立する必要があります。また、モード間の依存関係の管理方法も改善していきたいです。
2.  **運用面**: 実際のプロジェクトで使用感をフィードバックしてもらい、パフォーマンスの最適化やエラーハンドリングの強化を図りたいです。
3.  **ドキュメンテーション**: 新しいチームメンバー向けのガイドラインやトラブルシューティングガイドを整備する必要があります。

## まとめ

今日は、複数のAIエージェント間でrulesファイルを共有するための「モード選択型単一アダプター」方式を実装しました。各AIエージェントの特性に合わせてアダプターを作成し、シンボリックリンクを使って一元管理されたルールファイルを参照する構造を実現しました。また、タスク内容に応じて適切なモードを自動選択する機能も実装しました。

この実装により、複数のAIエージェント間で効率的に知識とモードを共有しながら、各エージェントの特性を活かした利用が可能になります。今後は、機能拡張や運用面の改善、ドキュメンテーションの整備を進めていきたいと思います。