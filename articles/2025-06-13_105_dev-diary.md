```
title: "OASISã‚’åˆ©ç”¨ã—ãŸNote.comè‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºï¼ˆé–‹ç™ºæ—¥è¨˜ No.105ï¼‰"
emoji: "ğŸ“"
type: "idea"
topics: ["é–‹ç™ºæ—¥è¨˜", "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°", "è‡ªå‹•æŠ•ç¨¿"]
published: false
---

:::message
ã“ã®è¨˜äº‹ã¯gemini-2.0-flash-001ã«ã‚ˆã£ã¦è‡ªå‹•ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
:::

## é–¢é€£ãƒªãƒ³ã‚¯

- [å‰å›ã®é–‹ç™ºæ—¥è¨˜](https://zenn.dev/centervil/articles/2025-06-13_105_dev-diary)

## ã¯ã˜ã‚ã«

æ˜¨æ—¥ã¯ã€Note.comã¸ã®è‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã«å‘ã‘ãŸè¨ˆç”»ã‚’ç«‹ã¦ã¾ã—ãŸã€‚ä»Šæ—¥ã¯ã€ãã®è¨ˆç”»ã«åŸºã¥ãã€OASISã¨ã„ã†Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸæŠ•ç¨¿æ©Ÿèƒ½ã®å®Ÿè£…ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚

## èƒŒæ™¯ã¨ç›®çš„

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã®è¨˜äº‹ã‚’åŠ¹ç‡çš„ã«Note.comã¸æŠ•ç¨¿ã™ã‚‹ãŸã‚ã«ã€è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚GitHub Actionsã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã—ã¦å®Ÿè£…ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å‹•ä½œæ¤œè¨¼ã‚‚å¯èƒ½ã«ã™ã‚‹ã“ã¨ã§ã€æŸ”è»Ÿãªé‹ç”¨ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## æ¤œè¨å†…å®¹

OASISã®å‹•ä½œæ¤œè¨¼ã€æŠ•ç¨¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè£…ã€GitHub Actionsãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰ã¨ã„ã†æµã‚Œã§ä½œæ¥­ã‚’é€²ã‚ã‚‹ã“ã¨ã‚’æ±ºå®šã—ã¾ã—ãŸã€‚ç‰¹ã«ã€OASISã®å‹•ä½œæ¤œè¨¼ã§ã¯ã€ä»®æƒ³ç’°å¢ƒã®æ§‹ç¯‰ã‚„èªè¨¼æƒ…å ±ã®ç¢ºèªãŒå¿…è¦ã¨ãªã‚‹ãŸã‚ã€æ‰‹é †ã‚’è©³ç´°åŒ–ã—ã¾ã—ãŸã€‚

## å®Ÿè£…å†…å®¹

ã¾ãšã¯OASISã®å‹•ä½œæ¤œè¨¼ã‹ã‚‰é–‹å§‹ã—ã¾ã—ãŸã€‚

1.  ä»®æƒ³ç’°å¢ƒã®ä½œæˆ
    ```bash
    python3 -m venv .venv_note_oasis
    ```
2.  ä»®æƒ³ç’°å¢ƒã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã¨OASISã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    ```bash
    source .venv_note_oasis/bin/activate && pip install --upgrade pip && pip install oasis-article
    ```
3.  Note.comã®èªè¨¼æƒ…å ±ã‚’`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®š

    ```env:.env.example
    # OASISï¼ˆoasis-articleï¼‰ç”¨ .env ã‚µãƒ³ãƒ—ãƒ«

    # Note.com èªè¨¼æƒ…å ±
    NOTE_EMAIL=your_note_email@example.com
    NOTE_PASSWORD=your_note_password
    NOTE_USER_ID=your_note_user_id

    # ï¼ˆå¿…è¦ã«å¿œã˜ã¦ä»–ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼æƒ…å ±ã‚‚è¿½è¨˜å¯èƒ½ï¼‰
    # QIITA_TOKEN=your_qiita_api_token
    # AUTH_USER=your_wordpress_username
    # AUTH_PASS=your_wordpress_password
    # BASE_URL=https://your_wordpress_site.com
    # GEMINI_API_KEY=your_gemini_api_key
    ```

4.  ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ã®ä½œæˆ

    ```bash
    mkdir -p tools/sample-article && echo -e '# ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹\n\nOASISã«ã‚ˆã‚‹Note.comè‡ªå‹•æŠ•ç¨¿ãƒ†ã‚¹ãƒˆã€‚' > tools/sample-article/sample.md
    ```

5.  OASISã®ãƒ˜ãƒ«ãƒ—è¡¨ç¤ºã¨å‹•ä½œç¢ºèª

    ```bash
    .venv_note_oasis/bin/oasis --help | tee tools/oasis_help.txt
    ```

    ```bash
    .venv_note_oasis/bin/oasis --folder_path tools/sample-article --note --note-email dummy@example.com --note-password dummy_pass --note-user-id dummy_id --firefox-headless > tools/oasis_note_test_output2.txt 2>&1
    ```

    ã“ã®æ®µéšã§ã€Gemini APIã‚­ãƒ¼ãŒæœªè¨­å®šã§ã‚ã‚‹ã¨ã„ã†è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

6.  è‡ªå‹•æŠ•ç¨¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®é››å½¢ã‚’ä½œæˆ

    ```diff
    -
    + import argparse
    + import subprocess
    + import sys
    + from pathlib import Path
    +
    +
    + def main():
    +     parser = argparse.ArgumentParser(description="æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®Markdownã‚’Note.comã«æŠ•ç¨¿ã™ã‚‹ï¼ˆOASISåˆ©ç”¨ï¼‰")
    +     parser.add_argument('--folder', required=True, help='æŠ•ç¨¿å¯¾è±¡ã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ãŒå…¥ã£ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª')
    +     parser.add_argument('--note-email', required=False, help='Note.comã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆçœç•¥æ™‚ã¯.envå‚ç…§ï¼‰')
    +     parser.add_argument('--note-password', required=False, help='Note.comã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆçœç•¥æ™‚ã¯.envå‚ç…§ï¼‰')
    +     parser.add_argument('--note-user-id', required=False, help='Note.comã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆçœç•¥æ™‚ã¯.envå‚ç…§ï¼‰')
    +     parser.add_argument('--firefox-headless', action='store_true', help='Firefoxã‚’ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ã§å®Ÿè¡Œ')
    +     args = parser.parse_args()
    +
    +     folder_path = Path(args.folder)
    +     if not folder_path.exists() or not folder_path.is_dir():
    +         print(f"[ERROR] æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“: {folder_path}")
    +         sys.exit(1)
    +
    +     # OASISã‚³ãƒãƒ³ãƒ‰çµ„ã¿ç«‹ã¦
    +     cmd = [
    +         sys.executable.replace('python', 'oasis'),
    +         '--folder_path', str(folder_path),
    +         '--note'
    +     ]
    +     if args.note_email:
    +         cmd += ['--note-email', args.note_email]
    +     if args.note_password:
    +         cmd += ['--note-password', args.note_password]
    +     if args.note_user_id:
    +         cmd += ['--note-user-id', args.note_user_id]
    +     if args.firefox_headless:
    +         cmd += ['--firefox-headless']
    +
    +     print(f"[INFO] å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰: {' '.join(cmd)}")
    +     result = subprocess.run(cmd, capture_output=True, text=True)
    +     print(result.stdout)
    +     if result.stderr:
    +         print(result.stderr, file=sys.stderr)
    +     if result.returncode != 0:
    +         print(f"[ERROR] æŠ•ç¨¿å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ (exit code: {result.returncode})", file=sys.stderr)
    +         sys.exit(result.returncode)
    +
    + if __name__ == '__main__':
    +     main()
    ```

    ãƒ•ã‚¡ã‚¤ãƒ«åï¼š`tools/note_post.py`

7.  ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®é››å½¢ã‚’ä½œæˆ

    ```diff
    -
    + import subprocess
    + import sys
    + from pathlib import Path
    +
    + def test_no_args():
    +     result = subprocess.run([sys.executable, 'tools/note_post.py'], capture_output=True, text=True)
    +     assert result.returncode != 0
    +     assert 'usage:' in result.stderr or 'usage:' in result.stdout
    +
    + def test_invalid_folder():
    +     result = subprocess.run([
    +         sys.executable, 'tools/note_post.py', '--folder', 'not_exist_dir'
    +     ], capture_output=True, text=True)
    +     assert result.returncode != 0
    +     assert 'å­˜åœ¨ã—ã¾ã›ã‚“' in result.stdout
    ```

    ãƒ•ã‚¡ã‚¤ãƒ«åï¼š`tests/test_note_post.py`

8.  ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã¨pytestã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

    ```bash
    .venv_note_oasis/bin/python -m pip install pytest
    ```

    ```bash
    .venv_note_oasis/bin/python -m pytest tests/ > tests/pytest_result.txt 2>&1
    ```

9.  Gemini APIã‚­ãƒ¼ã‚’è¨­å®šã—ã€å†åº¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ

    ```bash
    .venv_note_oasis/bin/python tools/note_post.py --folder tools/sample-article --firefox-headless
    ```

    ã“ã®æ™‚ç‚¹ã§ã€Gemini APIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…éã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

10. GitHub Actionsã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆ

    ```diff
    -
    + name: Post to Note.com with OASIS
    +
    + on:
    +   workflow_dispatch:
    +   push:
    +     paths:
    +       - 'security-study/**/*.md'
    +       - 'tools/note_post.py'
    +       - '.github/workflows/note_post.yml'
    +
    + jobs:
    +   post-to-note:
    +     runs-on: ubuntu-latest
    +     steps:
    +       - name: Checkout repository
    +         uses: actions/checkout@v4
    +
    +       - name: Set up Python
    +         uses: actions/setup-python@v5
    +         with:
    +           python-version: '3.12'
    +
    +       - name: Set up venv and install dependencies
    +         run: |
    +           python -m v