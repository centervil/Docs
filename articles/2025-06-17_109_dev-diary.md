```markdown
---
title: "ITIL4学習教材自動生成パイプライン構築（開発日記 No.109）"
emoji: "✅"
type: "idea"
topics: ["開発日記", "プログラミング", "GitHub Actions"]
published: false
---

:::message
この記事はgemini-2.0-flash-001によって自動生成されています。
:::

## 関連リンク

- [前回の開発日記](https://zenn.dev/centervil/articles/2025-06-16_108_dev-diary)

## はじめに

昨日はITIL4学習教材自動生成パイプラインの構築に取り組みました。本日は、その過程で発生したIssue #2に対応し、パイプラインのエラー解消と機能改善を目指します。

## 背景と目的

Issue #2は、ITIL4学習教材自動生成パイプラインの初期設定と`content-converter`の利用方法に関するものです。初期値の誤りや、`content-converter`の引数設定に不備があり、パイプラインが正常に動作していませんでした。これらの問題を解決し、教材の自動生成を安定させることを目的とします。

## 検討内容

まず、Issue #2の最新コメントを確認し、指摘されている問題点を洗い出しました。具体的には、`current_day.txt`の初期値の修正と、`content-converter`のインストール方法、引数の修正が必要です。また、GitHub Actionsの実行ログを分析し、エラーの原因を特定しました。

## 実装内容

以下に、具体的な実装内容を示します。

### 1. Issue #2 の初期値に関する修正

*   `security-study/ITIL4-Foundation/current_day.txt` の初期値を Issue の最新コメントに基づき `9` から `11` に修正しました。
*   `.github/workflows/generate_itil_study_material.yml` 内の、`current_day.txt` が存在しない場合の初期値も `11` に修正しました。

### 2. `content-converter` の利用方法に関する修正

*   `.github/workflows/generate_itil_study_material.yml` にて、`content-converter` のインストール方法を `pip install git+https://github.com/centervil/content-converter.git` に修正しました。
*   `content-converter` のコマンド引数を `--prompt "${{ steps.generate_prompt.outputs.GENERATED_PROMPT }}"` から `--input "security-study/ITIL4-Foundation/00_plan.md" --output "$OUTPUT_FOLDER_PATH/Day${CURRENT_DAY}_ITIL4-Foundation_study.md" --template "$FORMAT_FILE_PATH" --prompt "$PROMPT_FILE_PATH"` へと修正しました。
*   プロンプト文字列を直接渡すのではなく、一時ファイルに書き出してそのファイルパスを `--prompt` に渡すように変更しました。これにより、多行のプロンプトが正しく処理されるようになりました。

### 3. エラーの解消

上記の修正により、GitHub Actions のパイプライン ([実行ログ](https://github.com/centervil/Docs-Study/actions/runs/15701894750/job/44238439913)) で発生していたエラーが解消されました。

## 技術的なポイント

*   GitHub Actionsの`GITHUB_OUTPUT`に多行文字列を渡す際に、`EOF`デリミタを使用することで、特殊文字や改行を含む文字列を正しく処理できるようになりました。
*   `content-converter`にプロンプト文字列を直接渡すのではなく、一時ファイルに書き出してそのファイルパスを渡すことで、多行のプロンプトを正しく処理できるようになりました。

## 所感

Issue #2への対応を通して、GitHub Actionsのワークフロー定義や、`content-converter`の利用方法について深く理解することができました。特に、多行文字列の扱い方や、外部ツールへの引数渡し方など、実践的な知識を得ることができました。エラーが発生した際は、ログを丁寧に分析し、原因を特定することが重要だと改めて感じました。

## 今後の課題

GitHub Actionsの設定で、リポジトリの Actions > General > Workflow permissions にて `Read and write permissions` を有効にし、`Allow GitHub Actions to create and approve pull requests` をチェックする必要があることを確認しました。これにより、自動コミット・プッシュが可能になります。 今後はこの設定を行い、自動化をさらに進めていきたいと考えています。

## まとめ

本日は、ITIL4学習教材自動生成パイプライン構築におけるIssue #2に対応し、初期値の修正、`content-converter`の利用方法の改善、エラーの解消を行いました。これにより、パイプラインの安定性が向上し、教材の自動生成がスムーズに進むようになりました。

---

## 対話記録

私は今日、Issue #2に取り組むことにしました。まずは `@preparation-for-development.md` を読んで準備をします。

(数分後...)

`@preparation-for-development.md` の指示に従い、開発準備を進めます。最新の開発ログを確認するため、`dev-records/` ディレクトリのファイル一覧を取得しました。最新のログファイルは `2025-06-16_108_development.md` です。

以前の会話で、Issue のオーナーとリポジトリ名が `centervil/Docs-Study` であることが判明しているので、それを使って Issue #2 の詳細を取得します。

Issue #2、「ITIL4学習教材自動生成パイプラインの構築」に取り組むことを確認しました。

このIssueのタスクを以下の順序で進めます。

1.  `security-study/ITIL4-Foundation/current_day.txt` ファイルを作成し、初期の日付を「9」に設定します。
2.  `templates/itil_day_content_prompt_template.md` ファイルを作成し、指定されたプロンプトテンプレートの内容を追加します。
3.  `.github/workflows/generate_itil_study_material.yml` ファイルを作成し、GitHub Actions ワークフローを構築します。これには、Day番号の管理、`content-converter` のインストールと実行、生成されたファイルのコミットとプッシュが含まれます。

まずは、最初の2つのファイルを作成します。

（ファイル作成）

`current_day.txt` と `itil_day_content_prompt_template.md` の作成が完了しました。

次に、`.github/workflows/generate_itil_study_material.yml` ファイルを作成し、GitHub Actions ワークフローを構築します。Issue #2 の要件に基づいて、ワークフローを定義します。

（ワークフロー定義）

Issue #2 のための設定が完了しました。

*   `security-study/ITIL4-Foundation/current_day.txt` を作成し、初期値「9」を設定しました。
*   `templates/itil_day_content_prompt_template.md` を作成しました。
*   `.github/workflows/generate_itil_study_material.yml` にITIL4学習教材自動生成パイプラインを構築しました。

このワークフローを実行するためには、GitHub リポジトリの Settings -> Secrets and variables -> Actions に、以下の2つのシークレットを設定する必要があります。

*   `GOOGLE_API_KEY`
*   `LLM_MODEL`

これらのシークレットを設定後、今回の変更をリポジトリにプッシュすることで、ワークフローがスケジュール通りに実行されるようになります。

(数分後...)

Issue#2の最新のコメントを読みましたか？初期値の設定は9ではないはずです。

Issue #2 のコメントを再確認し、正しい初期値を見つけます。

(Issue #2 のコメントを確認...)

Issue #2 のコメントを確認しました。最新のコメントによると、`current_day.txt` の初期値は `9` ではなく `11` が正しいとのことです。

これを修正するため、まず `security-study/ITIL4-Foundation/current_day.txt` の内容を `11` に更新します。

（ファイル更新）

次に、GitHub Actions ワークフローファイル `.github/workflows/generate_itil_study_material.yml` 内の `Read and Increment Day Number` ステップで、`current_day.txt` が存在しない場合に初期値を `9` と設定している箇所を `11` に修正します。

まず、`generate_itil_study_material.yml` ファイルの内容を読み込みます。

（ファイル読み込み）

`.github/workflows/generate_itil_study_material.yml` ファイル内の、`current_day.txt` が存在しない場合に初期値を設定する行を `9` から `11` に変更します。

（ファイル修正）

Issue #2 のご指摘いただいた点について、修正が完了しました。

*   `security-study/ITIL4-Foundation/current_day.txt` の初期値を `11` に変更しました。
*   `.github/workflows/generate_itil_study_material.yml` 内で、`current_day.txt` が存在しない場合の初期値も `11` に修正しました。

これで、ITIL4学習教材自動