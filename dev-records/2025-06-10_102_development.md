<!-- Generated by SpecStory -->

# Diary conversion process modification plan (2025-06-10 09:50:56)

_**User**_

今日の開発テーマは、 @diary-convert.yml の改修です。Diary-Converterの利用を廃止し、変換エンジンをContent－Converterに変えます。
Content-Converterについては、@https://github.com/centervil/Content-Converter/blob/b7d91d8ff7c116362c21e3047c33d6b38fad4bf7/README.md を見てください。
まずは、作業計画を立ててください。

---

_**Assistant**_

---

今日の開発テーマは、`@diary-convert.yml` の改修ですね。`Diary-Converter` の利用を廃止し、変換エンジンを `Content-Converter` に変更するとのこと、承知いたしました。

**作業計画（要約）**
1. Content-Converterの使い方を確認
2. ワークフローの修正方針を検討
3. テンプレートやプロンプトの扱い方を整理

---

_**User**_

githubのリポジトリ上のファイルの内容を取得するためのURLはどうやって決まりますか？

---

_**Assistant**_

---

GitHubリポジトリ上のファイルの内容を直接取得するURLは、
`https://raw.githubusercontent.com/{owner}/{repo}/{branch}/{path_to_file}` 形式です。

---

_**User**_

@https://raw.githubusercontent.com/centervil/Content-Converter/main/README.md 

---

_**Assistant**_

---

READMEの内容を確認し、Content-Converterはpipでインストールして使うCLIツールであることを把握。

---

_**User**_

いや、READMEちゃんと読んで。Content-Converterはpip installで実行環境にインストールして使うものです。GithubActionとしては使えません

---

_**Assistant**_

---

ご指摘ありがとうございます。Content-ConverterはGitHub Actionとしてではなく、pipでインストールして使うCLIツールであることを再確認。

**修正方針**
- Python環境セットアップ
- Content-Converterのインストール
- コマンドラインでの実行に変更

---

_**User**_

修正はOKです。では、実際にcontent-converterの処理をローカルで試してみましょう。
@2025-06-09_101_development.md を変換してみてください。modelはgemini-flash-001, APIキーは、.envにGOOGLE_API_KEYとして登録しました

---

_**Assistant**_

---

ローカルで仮想環境を作成し、Content-Converterをインストール。必要な依存パッケージも追加。

- .envファイルのAPIキーが認識されない場合は、--api-key引数で直接渡す方法も検討。
- コマンド実行例やエラー内容は省略。

---

_**User**_

@2025-06-09_101_development.md を見ると、いくつか問題があります。
1. 記事全体がコードブロックで囲まれています。
2. "この記事はGPT-4によって自動生成されています。"となっていますが、モデル名が違います。
3. 前回の記事スラッグが入力されていない
4. ファイルの文末に、余計な文章が入力されています。

解決策として、Content-Converterに渡す --prompt 引数に渡すプロンプトを工夫して、こちらから入力するようにしましょう。

---

_**Assistant**_

---

**解決策要約**
- promptファイルを新規作成し、出力要件（コードブロック禁止、モデル名・スラッグの明示、余計な文の禁止等）を明記
- テンプレート内の[LLM Model名][前回の記事スラッグ]はパイプラインで置換する方式に変更

---

_**User**_

find-prev-article と find-diary の部分は、スクリプト化しましょう。

---

_**Assistant**_

---

find-latest-diary.sh, find-prev-article.sh をtools/に新規作成し、ローカル・CI/CD共通で利用できるようにしました。

---

_**User**_

ローカルで動作確認しましょう

---

_**Assistant**_

---

スクリプトとContent-Converterを組み合わせてローカルで動作確認。テンプレート置換・prompt指定・変換・後処理まで一連の流れを確認。

---

_**User**_

@2025-06-09_101_dev-diary.md を見ると、まだコードブロックが残っています。ただ、この問題は以前も起きましたし、LLMによる処理の限界だと認識しています。
そこで、Content-Converterが処理したテキストの後処理をします。
以前作った、 @document_processor.py を用意しましたので、これが使えるか確認して、使えるなら、パイプラインに組み込んで

---

_**Assistant**_

---

document_processor.py の remove_markdown_code_block メソッドを活用し、Content-Converterの出力後に後処理を追加。
- コードブロックが残る問題を自動で解消できるようにパイプラインに組み込み。

---

_**User**_

これで今日の開発をすべて終わります。

---

_**Assistant**_

---

本日の開発では、Content-Converterへの移行、ワークフローのスクリプト化、テンプレート・プロンプトの工夫、記事後処理の自動化まで一連の流れを整理・実装しました。

---
